# 图解TCP/IP第五版
论网络知识的重要性，网络基础对于任何一个IT行业相关，甚至不相关行业的人员，其重要性不言而喻。做为一名前端程序员，想要学好前端，网络是必须要跨过去的一道门槛。只有了解了网络，理解其中的原理，才能在工程项目中更好的优化代码，保证项目代码的稳定性，安全性。

# 🤔网络基础知识
## 1. 开始起飞：
### 🖊 计算机网络分类
**规模划分：**
* WAN(Wide Area Network,广域网) 
* LAN(Local Area Network,局域网)

### 🖊 计算机网络发展的七个阶段
- 批处理系统： 事先将用户程序和数据装入卡带或磁带，计算机按照一定的顺序读取并执行指令。
- 分时系统： （20世纪60年代）多台终端共用一台主机，主机轮流给每台终端处理任务。
- 计算机之间的通信：（20世纪70年代）计算机与计算之间由通信线路连接.
- 计算机网络产生：（20世纪80年代）
- 互联网普及：（20世纪90年代）
- 互联网技术为中心的时代
- 从“单纯建立连接”到“安全建立连接”


## 2.协议
在计算机通信中，实现达成一个详细的约定，并遵循这一约定进行处理尤为重要。这种约定其实就是协议。
![OSI七层模型作用](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP协议.JPG)  

|网络体系结构|协议|主要用途|
|--|--|--|
|TCP/IP|IP,ICMP,TCP,UDP,HTTP,TELNET,SNMP,SMTP|互联网，局域网|
|IPX/SPX|IPX,SPX,NPX, ....|个人电脑局域网|
|AppleTalk|DDP,RTMP,AEP,ATP,ZIP...|苹果公司现有产品的局域网|
|DECnet|DRP,NSP,SCP....|前DEC小型机|
|OSI|FTAM,MOTS,VT,CMIS/CMIP,CLNP,CONP|————|
|XNS|IDP,SPP,PEP|施乐公司网络|


### 🖊 分组交换协议
指的是将传输的大数据分割为一个个叫做“包”的较小单位进行传输。
![OSI七层模型作用](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP分组交换协议.JPG)
### 🖊 协议的标准化
为了解决不同厂家制定的协议互相不兼容带来的不便，ISO制定了一个国际标准OSI(Open System Interconnection),虽然没有被普及，但是却被做为制定其它协议的指导方针。

### 🖊 OSI七层模型
||OSI参考模型|描述|
|--|--|--|
|7|应用层|为应用程序提供服务并规定通信相关细节eg:HTTP, FTP,SMTP,SSH等|
|6|表示层|将应用处理的信息转换为适合网络传输的格式,负责数据格式的转换 eg:HTML, MIME|
|5|会话层|负责建立和断开通信连接,以及数据分割等数据传输相关的管理|
|4|传输层|负责数据传输TCP,UDP|
|3|网络层|将数据传输到目标地址，主要负责寻址和路由选择。ICMP,IGMP,IP|
|2|数据链路层|负责物理层面上连接，将0，1序列划分为有意义的数据帧传送|
|1|物理层|负责0、1比特流与电压的高低,光的闪灭之间的呼唤|
||||

#### OSI参考模型中各个分层的作用
![OSI七层模型作用](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP七层.JPG)


## 3. 传输方式
- 面向有连接 和 面向无连接  
**面向有连接：** 我和你确认好了，都准备好通信了，才互相交流  
**面向无连接：** 管你在不在，管你准没准备好，我都会把消息发送给你。

- 电路交换 和 分组交换  
**电路交换：** 此种通信方式会占用整条通信线路，直到断开连接，其它终端才能接入通信。主要用于电话网。  
**分组交换：** 通过将数据切分成多个数据包，数据包首部加入地址相关信息，一并收发，就可以让多台终端同时通信。分组交换中，由分组交换机（路由器）连接通信线路,路由器接收到数据后，会缓存到自己的缓冲区,然后再先进先出的发送给目标计算机。

- 根据接收端数量。  
**单播** **广播** **任播**

## 4. 地址
### 🖊 IP地址和Mac地址
- IP地址： 具有层次性，通信寻址过程中，必不可少。
- Mac地址: 不具有层次性，真正负责最终通信的地址。  

![地址](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP地址.JPG)


## 5. 网络的构成要素
设备|作用|
--|--
网卡|是计算机联网的设备
中继器（Repeater）|从物理层延长网络的设备
网桥（Bridge）/2层交换机|从数据链路层上延长网络的设备
路由器（Router）/3层交换机|通过网络层转发分组数据的设备
4-7层交换机|处理传输层以上各层网络传输的设备
网关（GateWay）|转换协议的设备

- 网卡：网络接口卡，也称网络适配器，网卡，LAN卡
- 中继器：是在OSI模型第一层——物理层面上延长网络的设备。  
![中继器](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP中继器.JPG)
- 网桥： 可以通过MAC地址自学机制和过滤功能控制网络流量
- 4-7层交换机：例如负载均衡器、防火墙、带宽控制
- 网关：负责OSI模型中从传输层到应用层协议翻译和转发数据。例如：互联网邮件和手机邮件间协议的转换。代理服务器也属于网关的一种（应用网关）；
  

***

# 🤔TCP/IP 基础知识

## 1. TCP/IP协议分层模型  

![TCP/IP参考模型](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP分层模型.JPG)

###  🖊 网络层（互联网层）

* IP：IP地址作为主机的标识，IP协议不具有重发机制，属于不可靠传输协议

* ICMP：IP数据包发送过程中一旦发生异常无法到达目的端，需要给发送端发送一个发生异常的通知，有ICMP来完成。

* ARP：从分组数据中解析出物理地址（MAC地址）的一种协议

### 🖊 传输层
传输层主要的功能就是让不同应用程序之间实现通信。有以下两种协议
1. **TCP** ：面向有连接的传输协议，三次握手、四次挥手。
2. **UDP** ：面向无连接的传输协议。

## 2.TCP/IP 分层模型与通信示例

### 🖊 数据包首部
每个分层中，都会对所发送的的数据添加一个首部,包含了该层的必要的信息，如地址等信息。  
> **包：** 可以说是全能性的描述语。  

> **帧：** 表示数据链路层中数据的单位。  

> **数据包：** IP 和 UDP 等网络层以上的数据的单位。  

> **段：**  表示TCP数据流中的数据的单位。  

> **消息：**  指应用协议中数据的单位。

![数据流动](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP数据流动.JPG) 


***

# 🤔 数据链路

数据链路,指OSI参考模型中的数据链路层，又是也指以太网，无线局域网等通信手段。  
数据链路层定义了通过通信媒介互联的设备之间传输的规范。  
数据链路层不是单纯的0、1序列,而是把它们集合为帧数据再发送。

- MAC地址：长48比特，使用网卡的情况下被烧入ROM中。

## 1.以太网
* **以太网帧格式**  

前导码|帧首部|数据|帧尾
--|--|--|--
8个字节|14个字节|46~1500字节|4字节
由0、1数字交替组成,表示以太帧的开始.|目标MAC地址6字节,源MAC地址6字节,上层协议类型2字节||FCS(Frame Check Sequence,帧检验序列)4个字节


# 🤔 IP协议
* IP地址(IPv4)由32位正整数来表示。
* IP地址由‘网络标识’和 ‘主机标识’两部分组成。

> 广播地址是连接到多址通信网络的所有设备都能够接收数据报的网络地址。发送到广播地址的消息可以由所有网络连接的主机接收。 相反，多播地址用于寻址特定的一组设备，单播地址用于寻址单个设备。 广播地址可以是网络层的IP地址。在以太网中，它可以是MAC地址

* 子网掩码:  
引用知乎上一个通俗易懂的回答。
> 子网掩码是一把剪刀ip地址是由或0或1的数字组成的长长的纸带把ip地址这张纸带用子网掩码一剪，左边是网络号纸带，右边是主机号纸带我是一台主机，如果你给我一个IP地址，我就先用子网掩码把这个IP地址剪开，看一下网络号纸带是不是和我一样如果一样就在同一个子网里，就可以直接发消息，如果不一样就不在一个子网里，需要网关帮忙转发消息如：假如有一主机的IP地址1000001，其子网掩码1110000，子网掩码即指示了网络号，主机号多少位.

![子网掩码](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP子网掩码.JPG)

* IP报文分割与重组  
由于以太网默认的MTU是1500字节，当发送的数据大于1500字节，则需要分割,最后由目标主机重组。

* 路径MTU发现  
为了解决IP数据分片造成的因丢失了某块分片导致整个IP数据报废的问题，产生一种新的技术“路径MTU发现”。  
路径MTU是指从发送端到接收主机端之间不需要分片时最大MTU的大小。  也就是在传输路径中存在的所有数据链路中最小的MTU。这样就可以避免在中途的路由器中进行分片。

* 路径MTU发现 的工作原理： 
  * 针对于UDP： 首先在发送端发送IP数据报时将其首部的分片禁止标志位设置为1。根据这个标志位，图中的路由器即使遇到需要分片才能处理的大包，也不会去分片，而是将包丢弃。随后，通过一个ICMP 的不可达消息将数据链路上的MTU的值发送给主机。  
  下一次，从发送给同一个目标主机的IP数据报中获得ICMP索通知的MTU值以后，将它设置为当前的MTU。发送主机根据这个MTU进行分片。如此反复。

  * 针对TCP： 在TCP的情况下，根据路径MTU的大小计算出最大段长度（MSS），然后再根据这些信息进行数据报的发送。
    > T C P的路径M T U发现按如下方式进行：在连接建立时， T C P使用输出接口或对端声明的M S S中的最小M T U作为起始的报文段大小。路径M T U发现不允许T C P超过对端声明的M S S。如果对端没有指定一个M S S，则默认为5 3 6。
    
  ![TCP_IP路径MTU](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP路径MTU.JPG)
  