# o(*￣▽￣*)ブ tCP/IP详解 卷一
<!-- TOC -->

- [o(*￣▽￣*)ブ tCP/IP详解 卷一](#o￣▽￣ブ-tcpip详解-卷一)
  - [📚概述](#📚概述)
  - [📚链路层](#📚链路层)
  - [📚IP协议](#📚ip协议)
  - [📚ICMP: Internet 控制报文协议](#📚icmp-internet-控制报文协议)

<!-- /TOC -->
## 📚概述
1. TCP/IP的分层
![TCP_IP详解_分层](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP详解_分层.JPG)  
ICMP是IP协议的附属协议。IP层用它来与其他主机或路由器交换错误报文和其他重要消息。虽然ICMP主要被IP使用，但应用程序也有可能访问他，如ping和Traceroute.


IGMP是Internet组管理协议。用来把一个UDP数据报多播到多个主机。

2. 封装数据
TCP传给IP的数据单元称作TCP报文段或简称TCP段(TCP segment).  
IP传给网络接口层的数据单元称作IP数据报(IP datagram)  
通过以太网传输的比特流称作帧（Frame）.  
IP和网络层之间传送的数据的单元更准确的应该是分组（packet）。分组既可以是一个IP数据报，也可以是IP数据报的一个分片。
![TCP_IP详解_封装数据](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP详解_封装数据.JPG)  

> **插曲： 计算最多有多少A类、B类、C类网络号？**  
> A类表示方法：网络.节点.节点.节点，8位表示网络，24位表示主机位  
> B类表示方法：网络.网络.节点.节点，16位表示网络，16位表示主机位  
> C类表示方法：网络.网络.网络.节点，24位表示网络，8位表示主机位  
>
> 通常我们判断一个ip地址是A类还是B类C类，几乎都是看子网掩码255.255.255.0，明摆着前三位网络位，第四位主机位，很显然是C类。  
>
> * **A类网络地址范围中，第一字节的第一位必须是0,所以其网络地址范围是：**  
> 00000000 ~ 01111111 故为0~127。所以A类地址网络号应该为2^7减去127开头的环回测试地址，再减去全部为1（即网络号第一位不为0）的地址，共2^7-2=126个  
>
> * **B类网络地址范围中，第一字节的前两位必须是10,所以其网络地址范围是：**  
> 10000000 ~ 10111111 故为128~191。所以B类地址网络号应为前两位为10开头，即网络号为10000000.00000000~10111111.11111111，去掉表示本网络的网络号全为0的地址，即10000000.00000000,则指派网络号为2^14-1=16383
>
> * **C类网络地址范围中，第一字节的前两位必须是110,所以其网络地址范围是：**  
> 11000000 ~ 11011111 故为192~223。所以C类地址网络号应为前两位为100开头，即网络号为11000000.00000000.00000000~11011111.11111111.11111111，去掉表示本网络的网络号全为0的地址，即11000000.00000000,则指派网络号为2^21-1=2097151  
>
> 简单判断，记为：  
> 000开头的都是A类地址  
> 100开头的都是B类地址  
> 110开头的都是C类地址  

## 📚链路层
0. 以太网和IEEE802封装
以太网这个术语一般是指数字设备公司、英特尔公司和Xerox公司在1982年联合公布的一个标准。它是当今TCP/IP采用的主要的局域网技术。它采用一种称作CSMA/CD的媒体接入方法，意思是 **带冲突检测的载波侦听多路接入（Carrier Sense,Multiple Access with Collision Detection）**。它的速率是10Mb/s, 地址48 bit。

IEEE802委员会在之后公布了一个稍有不同的标准集，其中：  
* 802.3 针对整个CSMA/CD网络
* 820.4 针对令牌总线网络  
* 802.5针对令牌环网络  
以上三种的共同特性由802.2标准定义，也就是802网络共有的逻辑链路控制（LLC）。  
802.2和802.3 定义了一个与以太网不同的帧格式。  
两种格式都采用48bit(6字节)的目的地址和源地址，也就是硬件地址。  
紧接着2字节在两种帧格式互不相同。802中是`长度字段`，指名它后续数据的字节长度，但不包括CRC检验码（用于帧内后续字节差错的循环冗余检验）。以太网则为`类型字段`,定义了后续数据的类型。802中的类型字段则有SNAP（子网接入协议）的首部给出。  
![TCP_IP详解_802以太网封装格式](https://raw.githubusercontent.com/forrestyuan/Reading-Book/master/assets/TCP_IP详解_802以太网封装格式.JPG)

1. 最大传输单元MTU
以太网和802.3对数据帧的长度都有一个限制，其最大值分别是1500和1492字节。链路层的这个特性称作MTU，最大传输单元。不同类型的网络大多数都有一个上限。如果一次传输的数据超过MTU，则需要分片后传输。

2. 路径MTU
当两台主机之间的通信需要通过多个网络，那么每个网络的链路层就可能有不同的MTU。重要的不是两台主机所在网络的MTU的值，重要的是两台通信主机路径中的最小MTU。它被称作路径MTU。

3. 串行线路吞吐量计算
如果线路速率是9600 b/s ,而一个字节有8bit，加上一个起始比特和一个停止比特，那么线路的速率就是960 B/s(字节/s).

## 📚IP协议
> X.25 是一个使用电话或者ISDN设备作为网络硬件设备来架构广域网的ITU-T网络协议  
> SNA  是IBM 系统网络体系结构 (IBM Systems Network Architecture)

1.  TTL（time to live）生存时间字段指定了数据包可以经过的最多路由器数量。它指定了数据包的生存时间。TTL的初始值有源主机设置（通常为32 或 64），一旦经过一个处理它的路由器，它的值就减1。当值为0时，就会被丢弃，并发送ICMP报文通知源主机。

## 📚ICMP: Internet 控制报文协议

1. ICMP报文实在IP数据包内部被传输。
2. 下面各种情况都不会产生差错报文：
   1. ICMP差错报文（ICMP查询报文可能会产生）、
   2. 目的地址是广播地址后多播地址的ip数据报
   3. 作为链路层广播的数据报
   4. 不是IP分片的第一片
   5. 源地址不是单个主机的数据报。也就是说源地址不能为零地址、环回地址、广播地址或多播地址