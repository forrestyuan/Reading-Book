# 埋点方案

通常埋点的需求是为了监控系统一系列数据，包括数据监控、性能监控、异常监控。
目前主流的前端监控系统主要有 [阿里 ARMS](https://www.aliyun.com/product/arms) 、[FUNdebug](https://www.fundebug.com/)、[sentry](https://sentry.io/welcome/) 等。

## 1.数据监控

这块主要是获取用户的一些行为数据，例如用户在页面停留的时间、用户点击行为、页面跳转行为等。

## 2.性能监控 & 异常监控
性能监控：主要获取系统的性能参数指标。目前性能指标数据大部分来源于 window.performance API
异常监控：主要收集系统的出错的信息，方便开发快速定位进行 hotfix。如果采用自行开发埋点，则可以利用以下方法进行捕获异常，并将其上报。

```js
  try-catch
  window.onerror
  window.addEventListener('error'，()=>{})
  window.addEventListener('unhandledrejection'()=>{})
```

这种方式将可能对业务代码造成较大的侵入性，开发耗时耗力且后续维护容易出问题。在异常监控这一块可以采用 Sentry 进行支持：

> [Sentry (https://sentry.io/welcome/)](https://sentry.io/welcome/) 是一个开源的实时错误追踪系统，可以帮助开发者实时监控并修复异常问题。它主要专注于持续集成、提高效率并且提升用户体验。  
> **Sentry** 分为服务端和客户端 SDK，可以直接使用其提供的在线服务，也可以本地自行搭建；提供了对多种主流语言和框架的支持，包括 React、Angular、Node、Django、RoR、PHP、Laravel、Android、.NET、JAVA 等。同时它可提供了和其他流行服务集成的方案，例如 GitHub、GitLab、bitbuck、heroku、slack、Trello 等。

**在 React 项目中配置 Sentry**

- 安装 Sentry

```js
npm install @sentry/react
//or
yarn add @sentry/react
```

- 在项目入口文件初始化

```js
import React from "react";
import ReactDOM from "react-dom";
import * as Sentry from "@sentry/react";
import App from "./App";

Sentry.init({
  dsn: "https://<key>@sentry.io/<project>",
  release: "my-project-name@" + process.env.npm_package_version,
});

ReactDOM.render(<App />, document.getElementById("root"));
```

所有未被捕获的异常和未处理的 promise rejection 都将被 Senty 捕获进行上报到 Sentry。
